# 什么是约束？

约束对应的英语单词：constraint
在创建表的时候，我们可以给表中的字段加上一些约束，来保证这个表中数据的
完整性、有效性！！！

**约束的作用就是为了保证表中的数据有效！！**



# 约束包括哪些？

​	非空约束：not null
​	唯一性约束: unique
​	主键约束: primary key （简称PK）
​	外键约束：foreign key（简称FK）
​	检查约束：check（mysql不支持，oracle支持）

## 非空约束：not null

非空约束not null约束的字段不能为NULL。
	drop table if exists t_vip;
	create table t_vip(
		id int,
		name varchar(255) not null 
	);

insert into t_vip(id) values(3);
ERROR 1364 (HY000): Field 'name' doesn't have a default value

## 唯一性约束: unique

唯一性约束unique约束的字段不能重复，但是可以为NULL。
drop table if exists t_vip;
create table t_vip(
	id int,
	name varchar(255) unique,
	email varchar(255)
);
insert into t_vip(id,name,email)  values(3,'wangwu','wangwu@123.com');

insert into t_vip(id,name,email) values(4,'wangwu','wangwu@sina.com');
ERROR 1062 (23000): Duplicate entry 'wangwu' for key 'name'

**name字段虽然被unique约束了，但是可以为NULL。且可以有多个人的是null**



新需求：name和email两个字段联合起来具有唯一性！！！！
		drop table if exists t_vip;
		create table t_vip(
			id int,
			name varchar(255) unique,  // **约束直接添加到列后面的，叫做列级约束。**
			email varchar(255) unique
		);
		这张表这样创建是不符合我以上“新需求”的。
		这样创建表示：name具有唯一性，email具有唯一性。各自唯一。

正确做法：

​		drop table if exists t_vip;
​		create table t_vip(
​			id int,
​			name varchar(255),
​			email varchar(255),
​			unique(name,email) // **约束没有添加在列的后面，这种约束被称为表级约束。**
​		);

需要给多个字段联合起来添加某一个约束的时候，需要使用表级约束

**not null只有列级约束，没有表级约束！**



**在mysql当中，如果一个字段同时被not null和unique约束的话，该字段自动变成主键字段。（注意：oracle中不一样！）**



## 主键约束（primary key，简称PK）

### 主键约束的相关术语？

​	主键约束：就是一种约束。
​	主键字段：该字段上添加了主键约束，这样的字段叫做：主键字段
​	主键值：主键字段中的每一个值都叫做：主键值。



### 什么是主键？有啥用？

​		**主键值是每一行记录的唯一标识。**
​		主键值是每一行记录的身份证号！！！

**记住：任何一张表都应该有主键（且仅有一个），没有主键，表无效！！**

**主键的特征：not null + unique（主键值不能是NULL，同时也不能重复！）**

**主键可以使用表级约束**

表级约束主要是给多个字段联合起来添加约束

几个字段联合起来的主键叫   复合主键

**在实际开发中不建议使用复合主键。建议使用单一主键**

主键值建议使用：
	int
	bigint
	char
	等类型。

不建议使用：varchar来做主键。主键值一般都是数字，一般都是定长的！



### 主键除了：单一主键和复合主键之外，还可以这样进行分类？

​			自然主键：主键值是一个自然数，和业务没关系。
​			业务主键：主键值和业务紧密关联，例如拿银行卡账号做主键值。这就是业务主键！

​	在实际开发中使用业务主键多，还是使用自然主键多一些？
​			自然主键使用比较多，因为主键只要做到不重复就行，不需要有意义。
​			**业务主键不好，因为主键一旦和业务挂钩，那么当业务发生变动的时候，
​			可能会影响到主键值，所以业务主键不建议使用。尽量使用自然主键。**



在mysql当中，**有一种机制，可以帮助我们自动维护一个主键值**
		drop table if exists t_vip;
		create table t_vip(
			id int primary key auto_increment,
			name varchar(255)
		);

**auto_increment 表示自增，从1开始，以1递增！**



## 外键约束（foreign key，简称FK）

外键约束涉及到的相关术语：
	外键约束：一种约束（foreign key）
	外键字段：该字段上添加了外键约束
	外键值：外键字段当中的每一个值。

```
业务背景：
		请设计数据库表，来描述“班级和学生”的信息？

		第一种方案：班级和学生存储在一张表中？？？
		t_student
		no(pk)		name		classno			classname
		----------------------------------------------------------------------------------
		1			jack		100			北京市大兴区亦庄镇第二中学高三1班
		2			lucy		100			北京市大兴区亦庄镇第二中学高三1班
		3			lilei		100			北京市大兴区亦庄镇第二中学高三1班
		4			hanmeimei	100			北京市大兴区亦庄镇第二中学高三1班
		5			zhangsan	101			北京市大兴区亦庄镇第二中学高三2班
		6			lisi		101			北京市大兴区亦庄镇第二中学高三2班
		7			wangwu		101			北京市大兴区亦庄镇第二中学高三2班
		8			zhaoliu		101			北京市大兴区亦庄镇第二中学高三2班
		分析以上方案的缺点：
			数据冗余，空间浪费！！！！
			这个设计是比较失败的！
		
		第二种方案：班级一张表、学生一张表？？
		
		t_class 班级表
		classno(pk)			classname
		------------------------------------------------------
		100					北京市大兴区亦庄镇第二中学高三1班
		101					北京市大兴区亦庄镇第二中学高三1班
	
		t_student 学生表
		no(pk)			name			cno(FK引用t_class这张表的classno)
		----------------------------------------------------------------
		1				jack			100
		2				lucy			100
		3				lilei			100
		4				hanmeimei		100
		5				zhangsan		101
		6				lisi			101
		7				wangwu			101
		8				zhaoliu			101

		当cno字段没有任何约束的时候，可能会导致数据无效。可能出现一个102，但是102班级不存在。
		所以为了保证cno字段中的值都是100和101，需要给cno字段添加外键约束。
		那么：cno字段就是外键字段。cno字段中的每一个值都是外键值。
```

**注意：理解即记住**

删除表的顺序？
	先删子，再删父。

创建表的顺序？
	先创建父，再创建子。

删除数据的顺序？
	先删子，再删父。

插入数据的顺序？
	先插入父，再插入子。

```
create table t_class (
	classno int primary key,
	classname varchar(255);
);
create table t_student (
	no int primary key auto_increment,
	name varchar(255),
	cno int,
	foreign key(cno) references t_class(classno)
);
```

思考：子表中的外键引用的父表中的某个字段，被引用的这个字段必须是主键吗？
			不一定是主键，但至少具有unique约束。

即：**外键引用的字段不一定是主键，但一定要有unique约束**

测试：外键值可以为NULL吗？
	  **外键只要满足至少含有unique约束即可，而有unique修饰的字段字段可以为NULL(而且可以有多个NULL)，所以外键值当然可以为NULL。**


