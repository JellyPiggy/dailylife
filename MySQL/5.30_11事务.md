# 什么是事务？

**一个事务其实就是一个完整的业务逻辑。**
是一个最小的工作单元。不可再分。

**说到本质上，一个事务其实就是多条DML语句同时成功，或者同时失败！**

	什么是一个完整的业务逻辑？
		假设转账，从A账户向B账户中转账10000.
		将A账户的钱减去10000（update语句）
		将B账户的钱加上10000（update语句）
		这就是一个完整的业务逻辑。
	
		以上的操作是一个最小的工作单元，要么同时成功，要么同时失败，不可再分。
		这两个update语句要求必须同时成功或者同时失败，这样才能保证钱是正确的。
**只有DML语句才会有事务这一说，其它语句和事务无关！！！**
	insert
	delete
	update
只有以上的三个语句和事务有关系，其它都没有关系。

因为 只有以上的三个语句是数据库表中数据进行增、删、改的。
只要你的操作一旦涉及到数据的增、删、改，那么就一定要考虑安全问题。

数据安全第一位！！



## 事务是怎么做到多条DML语句同时成功和同时失败的呢？

InnoDB存储引擎：提供一组用来记录事务性活动的日志文件

事务开启了：
insert
insert
delete
update
update
事务结束了！

在事务的执行过程中，每一条DML的操作都会记录到“事务性活动的日志文件”中。
在事务的执行过程中，我们可以提交事务，也可以回滚事务。

提交事务？
	清空事务性活动的日志文件，将数据全部彻底持久化到数据库表中。
	提交事务标志着，事务的结束。并且是一种全部成功的结束。

回滚事务？
	将之前所有的DML操作全部撤销，并且清空事务性活动的日志文件
	回滚事务标志着，事务的结束。并且是一种全部失败的结束。



## 怎么提交事务，怎么回滚事务？

提交事务：commit; 语句
回滚事务：rollback; 语句（回滚永远都是只能回滚到上一次的提交点！）

事务对应的英语单词是：transaction

测试一下，在mysql当中默认的事务行为是怎样的？
	**mysql默认情况下是支持自动提交事务的。（自动提交）**
	什么是自动提交？
		每执行一条DML语句，则提交一次！

这种自动提交实际上是不符合我们的开发习惯，因为一个业务通常是需要多条DML语句共同执行才能完成的，为了保证数据的安全，必须要求同时成功之后再提交，所以不能执行一条
就提交一条。

怎么将mysql的自动提交机制关闭掉呢？
**开启事务时先执行这个命令：start transaction;**



## 事务的四个特性

事务包括4个特性？

A：原子性
	说明事务是最小的工作单元。不可再分。所有操作必须同时成功，或者同时失败。

C：一致性
	一个事务在执行前后，数据库都必须处于正确的状态，满足完整性约束。也就是说事务不能破坏数据库的完整性以及业务逻辑的一致性。

​    例如：

​    业务逻辑一致性：A给B转账，无论是否操作成功，两者的账户余额之和应该是不变的。

​    数据库完整性：数据库的约束关系应该是正确的，例如唯一索引，主键等。

I：隔离性
	同时执行的事务是相互隔离的，它们不能相互冒犯。

D：持久性
	事务最终结束的一个保障。事务提交，就相当于将没有保存到硬盘上的数据
	保存到硬盘上！



 